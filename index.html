<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <!-- Meta tags de seguranÃ§a -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta http-equiv="Content-Security-Policy" 
          content="default-src 'self'; 
                   script-src 'self' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net;
                   style-src 'self' 'unsafe-inline';
                   img-src 'self' data:;
                   font-src 'self';
                   connect-src 'self' https:;
                   frame-ancestors 'none';
                   base-uri 'self';
                   form-action 'self';">
    
    <title>ğŸ” Controle Financeiro - Seguro</title>
    <link rel="stylesheet" href="style.css">
    
    <!-- Scripts de seguranÃ§a (PRIMEIRO!) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="seguranca.js"></script>
    
    <!-- Scripts de biblioteca -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>

<body>

<div class="container">
    <h1>ï¿½ Planejamento Financeiro</h1>

    <!-- Dashboard Resumo -->
    <div class="secao">
        <h2>ğŸ’¼ VisÃ£o Geral</h2>
        <div class="resumo">
            <div class="card entrada">
                <p>Despesas Fixas</p>
                <div class="valor">R$ <span id="totalFixas">0.00</span></div>
            </div>
            <div class="card saida">
                <p>Despesas VariÃ¡veis</p>
                <div class="valor">R$ <span id="totalVariaveis">0.00</span></div>
            </div>
            <div class="card saldo">
                <p>Total Planejado</p>
                <div class="valor">R$ <span id="totalPlanejado">0.00</span></div>
            </div>
            <div class="card saldo">
                <p>Saldo DisponÃ­vel</p>
                <div class="valor">R$ <span id="saldoDisponivel">0.00</span></div>
            </div>
        </div>
    </div>

    <!-- Dashboard Executivo KPIs -->
    <div class="secao">
        <h2>ğŸ“Š Dashboard Executivo</h2>
        <div class="dashboard-kpi">
            <div class="kpi-card receita">
                <div class="kpi-label">ğŸ’° Receitas MÃªs</div>
                <div class="kpi-valor" id="kpiReceitasMes">R$ 0,00</div>
                <div class="kpi-subtext" id="kpiReceitasSubtext">+ Renda: R$ 0,00</div>
            </div>
            <div class="kpi-card despesa">
                <div class="kpi-label">ğŸ“Œ Despesas MÃªs</div>
                <div class="kpi-valor" id="kpiDespesasMes">R$ 0,00</div>
                <div class="kpi-subtext" id="kpiDespesasSubtext">Fixas + VariÃ¡veis</div>
            </div>
            <div class="kpi-card saldo">
                <div class="kpi-label">ğŸ’³ Saldo Total</div>
                <div class="kpi-valor" id="kpiSaldoTotal">R$ 0,00</div>
                <div class="kpi-subtext" id="kpiSaldoSubtext">Inicial + DiferenÃ§a</div>
            </div>
            <div class="kpi-card percentual">
                <div class="kpi-label">ğŸ“ˆ Taxa PoupanÃ§a</div>
                <div class="kpi-valor" id="kpiTaxaPoupanca">0%</div>
                <div class="kpi-subtext">Do total de receitas</div>
            </div>
        </div>
    </div>

    <!-- INVESTIMENTOS -->
    <div class="secao">
        <h2>ğŸ’ Investimentos</h2>
        <div class="form-grid">
            <input type="number" id="valorInvestimento" placeholder="Valor (R$)" step="0.01" min="0">
            <select id="tipoInvestimento">
                <option value="">Tipo de Investimento</option>
                <option value="Renda Fixa">Renda Fixa (CDB, Tesouro)</option>
                <option value="AÃ§Ãµes">AÃ§Ãµes</option>
                <option value="Fundos">Fundos de Investimento</option>
                <option value="Criptomoedas">Criptomoedas</option>
                <option value="ImÃ³veis">ImÃ³veis</option>
                <option value="PoupanÃ§a">PoupanÃ§a</option>
                <option value="Ouro">Ouro/Metais Preciosos</option>
                <option value="Outro">Outro</option>
            </select>
            <input type="text" id="descricaoInvestimento" placeholder="DescriÃ§Ã£o (ex: CDB Banco X)">
            <input type="date" id="dataInvestimento">
            <button onclick="adicionarInvestimento()" class="secondary">â• Adicionar Investimento</button>
        </div>

        <div style="margin-top: 30px;">
            <h3 style="color: #667eea; margin-bottom: 15px;">ğŸ“Š Resumo de Investimentos</h3>
            <div class="kpi-row" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px;">
                <div class="card" style="background: linear-gradient(135deg, rgba(111,221,156,0.1) 0%, #ffffff 100%); border-left: 4px solid #6fdd9c;">
                    <div style="font-size: 0.85em; color: #666;">Total Investido</div>
                    <div style="font-size: 1.8em; font-weight: bold; color: #6fdd9c; margin: 10px 0;">R$ <span id="totalInvestido">0,00</span></div>
                </div>
                <div class="card" style="background: linear-gradient(135deg, rgba(102,126,234,0.1) 0%, #ffffff 100%); border-left: 4px solid #667eea;">
                    <div style="font-size: 0.85em; color: #666;">NÃºmero de Investimentos</div>
                    <div style="font-size: 1.8em; font-weight: bold; color: #667eea; margin: 10px 0;" id="totalInvestimentos">0</div>
                </div>
                <div class="card" style="background: linear-gradient(135deg, rgba(118,75,162,0.1) 0%, #ffffff 100%); border-left: 4px solid #764ba2;">
                    <div style="font-size: 0.85em; color: #666;">Maior Investimento</div>
                    <div style="font-size: 1.8em; font-weight: bold; color: #764ba2; margin: 10px 0;">R$ <span id="maiorInvestimento">0,00</span></div>
                </div>
            </div>
        </div>

        <div style="margin-top: 20px;">
            <h3 style="color: #667eea; margin-bottom: 15px;">ğŸ’¹ DistribuiÃ§Ã£o por Tipo</h3>
            <div class="grafico-container">
                <canvas id="graficoInvestimentos"></canvas>
            </div>
        </div>

        <div style="margin-top: 30px;">
            <h3 style="color: #667eea; margin-bottom: 15px;">ğŸ“‹ Lista de Investimentos</h3>
            <table class="tabela-consolidada" style="width: 100%;">
                <thead>
                    <tr style="background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); color: white; font-weight: bold;">
                        <th style="padding: 12px 16px; text-align: left;">Data</th>
                        <th style="padding: 12px 16px; text-align: left;">Tipo</th>
                        <th style="padding: 12px 16px; text-align: left;">DescriÃ§Ã£o</th>
                        <th style="padding: 12px 16px; text-align: right;">Valor</th>
                        <th style="padding: 12px 16px; text-align: center;">AÃ§Ã£o</th>
                    </tr>
                </thead>
                <tbody id="tabelaInvestimentos">
                </tbody>
            </table>
        </div>
    </div>

    <!-- CONFIGURAÃ‡Ã•ES E RECEITAS -->
    <div class="secao">
        <h2>âš™ï¸ ConfiguraÃ§Ãµes e Receitas</h2>
        <div class="form-grid">
            <input type="number" id="saldoInicial" placeholder="Saldo Inicial (R$)" step="0.01" min="0">
            <input type="number" id="rendaMensal" placeholder="Renda Mensal (R$)" step="0.01" min="0">
            <button onclick="salvarConfiguraÃ§Ãµes()" class="secondary">ğŸ’¾ Salvar ConfiguraÃ§Ãµes</button>
        </div>

        <div style="margin-top: 20px;">
            <h3 style="color: #667eea; margin-bottom: 15px;">ğŸ’° Adicionar Receita</h3>
            <form id="formReceita" style="display: contents;">
                <div class="form-grid">
                    <input type="date" id="dataReceita" placeholder="Data">
                    <input type="text" id="descricaoReceita" placeholder="DescriÃ§Ã£o (ex: SalÃ¡rio)">
                    <select id="categoriaReceita">
                        <option value="">Selecione Categoria</option>
                        <option value="SalÃ¡rio">ğŸ’µ SalÃ¡rio</option>
                        <option value="Freelance">ğŸ’» Freelance</option>
                        <option value="BÃ´nus">ğŸ BÃ´nus</option>
                        <option value="Investimento">ğŸ“ˆ Investimento</option>
                        <option value="Outros">ğŸ“Œ Outros</option>
                    </select>
                    <input type="number" id="valorReceita" placeholder="Valor" step="0.01" min="0">
                    <button type="button" onclick="adicionarReceita()">â• Adicionar Receita</button>
                </div>
            </form>
        </div>

        <!-- Tabela de Receitas -->
        <table id="tabelaReceitas" style="margin-top: 20px;">
            <thead>
                <tr>
                    <th>Data</th>
                    <th>DescriÃ§Ã£o</th>
                    <th>Categoria</th>
                    <th>Valor</th>
                    <th style="width: 80px;">AÃ§Ã£o</th>
                </tr>
            </thead>
            <tbody id="corpoReceitas"></tbody>
        </table>
    </div>

    <!-- ALERTAS -->
    <div id="containerAlertas" style="margin-top: 20px;"></div>

    <!-- PENDENTES PARA PAGAMENTO -->
    <div class="secao">
        <h2>âš ï¸ Pendentes para Pagamento</h2>
        <div id="containerPendentes"></div>
    </div>

    <!-- VISÃƒO CONSOLIDADA - Tabela Resumida -->
    <div class="secao">
        <h2>ğŸ“‹ VisÃ£o Geral (Tipo Excel)</h2>
        <div style="overflow-x: auto;">
            <table id="tabelaConsolidada" class="tabela-consolidada">
                <thead>
                    <tr style="background: #667eea; color: white; font-weight: bold;">
                        <th style="width: 80px;">Data</th>
                        <th style="width: 200px;">DescriÃ§Ã£o</th>
                        <th style="width: 120px;">Categoria</th>
                        <th style="width: 100px;">Tipo</th>
                        <th style="width: 100px; text-align: right;">Valor</th>
                    </tr>
                </thead>
                <tbody id="corpoConsolidado"></tbody>
            </table>
        </div>
    </div>

    <!-- DESPESAS FIXAS -->
    <div class="secao">
        <h2>ğŸ“Œ Despesas Fixas (Mensais)</h2>
        <div class="form-grid">
            <input type="text" id="descricaoFixa" placeholder="DescriÃ§Ã£o (ex: Aluguel)">
            <select id="categoriaFixa">
                <option value="">Selecione Categoria</option>
                <option value="HabitaÃ§Ã£o">ğŸ  HabitaÃ§Ã£o</option>
                <option value="Transporte">ğŸš— Transporte</option>
                <option value="SaÃºde">âš•ï¸ SaÃºde</option>
                <option value="EducaÃ§Ã£o">ğŸ“š EducaÃ§Ã£o</option>
                <option value="Utilities">ğŸ’¡ Utilities</option>
                <option value="Seguros">ğŸ›¡ï¸ Seguros</option>
                <option value="Assinaturas">ğŸ“º Assinaturas</option>
                <option value="Outros">ğŸ“Œ Outros</option>
            </select>
            <input type="number" id="valorFixo" placeholder="Valor Mensal" step="0.01" min="0">
            <button onclick="adicionarFixa()">â• Adicionar Fixa</button>
        </div>

        <!-- Tabela de Despesas Fixas -->
        <table id="tabelaFixas">
            <thead>
                <tr>
                    <th style="width: 40px;">âœ“</th>
                    <th>DescriÃ§Ã£o</th>
                    <th>Categoria</th>
                    <th>Valor Mensal</th>
                    <th style="width: 80px;">AÃ§Ã£o</th>
                </tr>
            </thead>
            <tbody id="corpoFixas"></tbody>
        </table>
    </div>

    <!-- DESPESAS VARIÃVEIS -->
    <div class="secao">
        <h2>ğŸ“… Despesas VariÃ¡veis (Este MÃªs)</h2>
        <div class="form-grid">
            <input type="date" id="data" placeholder="Data">
            <input type="text" id="descricao" placeholder="DescriÃ§Ã£o (ex: Supermercado)">
            <select id="categoria">
                <option value="">Selecione Categoria</option>
                <option value="AlimentaÃ§Ã£o">ğŸ” AlimentaÃ§Ã£o</option>
                <option value="Transporte">ğŸš— Transporte</option>
                <option value="SaÃºde">âš•ï¸ SaÃºde</option>
                <option value="EducaÃ§Ã£o">ğŸ“š EducaÃ§Ã£o</option>
                <option value="Lazer">ğŸ® Lazer</option>
                <option value="Utilities">ğŸ’¡ Utilities</option>
                <option value="Compras">ğŸ›ï¸ Compras</option>
                <option value="Outros">ğŸ“Œ Outros</option>
            </select>
            <input type="number" id="valor" placeholder="Valor" step="0.01" min="0">
            <button onclick="adicionarVariavel()">â• Adicionar Gasto</button>
        </div>

        <!-- Tabela de Despesas VariÃ¡veis -->
        <table id="tabelaVariaveis">
            <thead>
                <tr>
                    <th style="width: 40px;">âœ“</th>
                    <th>Data</th>
                    <th>DescriÃ§Ã£o</th>
                    <th>Categoria</th>
                    <th>Valor</th>
                    <th style="width: 80px;">AÃ§Ã£o</th>
                </tr>
            </thead>
            <tbody id="corpoVariaveis"></tbody>
        </table>
    </div>

    <!-- Resumo por Categoria -->
    <div class="secao">
        <h2>ğŸ“Š Resumo por Categoria (Este MÃªs)</h2>
        <div id="categoriaResumo" class="categoria-resumo"></div>
    </div>

    <!-- FILTRO E ANÃLISE POR PERÃODO -->
    <div class="secao">
        <h2>ğŸ“… AnÃ¡lise por PerÃ­odo</h2>
        <div class="form-grid">
            <input type="date" id="dataInicio" placeholder="Data InÃ­cio">
            <input type="date" id="dataFim" placeholder="Data Fim">
            <button onclick="filtrarPorPeriodo()" class="secondary">ğŸ” Filtrar</button>
            <button onclick="limparFiltro()" class="secondary">ğŸ”„ Limpar</button>
        </div>
        <div id="containerAnalisisePeriodo" style="margin-top: 20px;"></div>
    </div>

    <!-- COMPARATIVO MÃŠS A MÃŠS -->
    <div class="secao">
        <h2>ğŸ“ˆ Comparativo MÃªs a MÃªs</h2>
        <div id="containerComparativo" class="tabela-comparativa"></div>
    </div>

    <!-- RESUMO MENSAL DETALHADO -->
    <div class="secao">
        <h2>ğŸ“‹ Resumo Mensal Detalhado</h2>
        <div class="form-grid">
            <input type="month" id="mesSelecionado">
            <button onclick="gerarResumoMensal()" class="secondary">ğŸ“Š Gerar Resumo</button>
        </div>
        <div id="containerResumoMensal" style="margin-top: 20px;"></div>
    </div>

    <!-- ğŸŸ¢ 1. GRÃFICO DE EVOLUÃ‡ÃƒO DO SALDO -->
    <div class="secao">
        <h2>ğŸ“Š EvoluÃ§Ã£o do Saldo</h2>
        <div class="grafico-container">
            <canvas id="graficoEvolucaoSaldo"></canvas>
        </div>
    </div>

    <!-- ğŸŸ¢ 2. SCORE DE SAÃšDE FINANCEIRA -->
    <div class="secao">
        <h2>ğŸ’š SaÃºde Financeira</h2>
        <div class="score-container">
            <div class="score-circle">
                <div class="score-valor" id="scoreValor">0</div>
                <div class="score-label">Score</div>
            </div>
            <div class="score-detalhes">
                <div class="score-metrica">
                    <span>ğŸ’¾ Taxa de Economia:</span>
                    <span id="metricaEconomia">0%</span>
                    <span class="score-status" id="statusEconomia">âŒ</span>
                </div>
                <div class="score-metrica">
                    <span>ğŸ“Œ Fixas/Receita:</span>
                    <span id="metricaFixas">0%</span>
                    <span class="score-status" id="statusFixas">âŒ</span>
                </div>
                <div class="score-metrica">
                    <span>ğŸ’ Investimento/Receita:</span>
                    <span id="metricaInvestimento">0%</span>
                    <span class="score-status" id="statusInvestimento">âŒ</span>
                </div>
                <div class="score-recomendacao" id="scoreRecomendacao"></div>
            </div>
        </div>
    </div>

    <!-- ğŸŸ¢ 3. ALERTAS INTELIGENTES -->
    <div class="secao">
        <h2>ğŸš¨ Alertas Inteligentes</h2>
        <div id="containerAlertasInteligentes"></div>
    </div>

    <!-- ğŸŸ¢ 4. PREVISÃƒO DE CAIXA -->
    <div class="secao">
        <h2>ğŸ”® PrevisÃ£o de Caixa</h2>
        <div id="containerPrevisaoCaixa" class="comparacao-grid"></div>
    </div>

    <!-- ğŸŸ¢ 5. COMPARATIVO "VOCÃŠ VS VOCÃŠ" -->
    <div class="secao">
        <h2>ğŸ“Š Comparativo PerÃ­odos</h2>
        <div id="containerComparativoVoce" class="comparacao-grid"></div>
    </div>

    <!-- ğŸŸ¢ 6. METAS COM PROGRESSO -->
    <div class="secao">
        <h2>ğŸ¯ Metas com Progresso</h2>
        <div class="form-grid">
            <input type="text" id="nomeMeta" placeholder="Nome da categoria">
            <input type="number" id="valorMeta" placeholder="Limite (R$)" step="0.01" min="0">
            <button onclick="adicionarMeta()" class="secondary">â• Adicionar Meta</button>
        </div>
        <div id="containerMetasProgresso" style="margin-top: 20px;"></div>
    </div>

    <!-- ğŸŸ¢ 7. RELATÃ“RIO AUTOMATIZADO -->
    <div class="secao">
        <h2>ğŸ“„ RelatÃ³rio Personalizado</h2>
        <div class="form-grid">
            <select id="tipoRelatorio">
                <option value="">Selecione o tipo</option>
                <option value="mensal">RelatÃ³rio Mensal</option>
                <option value="trimestral">RelatÃ³rio Trimestral</option>
                <option value="anual">RelatÃ³rio Anual</option>
            </select>
            <button onclick="gerarRelatorioPersonalizado()" class="secondary">ğŸ“‹ Gerar RelatÃ³rio</button>
            <button onclick="exportarRelatorioJSON()" class="secondary">ğŸ’¾ Salvar JSON</button>
        </div>
        <div id="containerRelatorio" style="margin-top: 20px;"></div>
    </div>

    <!-- ğŸŸ¢ 8. DASHBOARD DE EFICIÃŠNCIA -->
    <div class="secao">
        <h2>âš¡ EficiÃªncia Financeira</h2>
        <div id="containerEficiencia" class="eficiencia-grid"></div>
    </div>

    <!-- ğŸŸ¢ 9. MAPA DE DESPESAS (HEATMAP) -->
    <div class="secao">
        <h2>ğŸ”¥ Mapa de Despesas</h2>
        <div class="form-grid">
            <select id="mesSelecionadoHeatmap">
                <option value="">Selecione o mÃªs</option>
            </select>
        </div>
        <div id="containerHeatmap" style="margin-top: 20px;"></div>
    </div>

    <!-- ğŸŸ¢ 10. SEGMENTAÃ‡ÃƒO POR OBJETIVO -->
    <div class="secao">
        <h2>ğŸ¯ Objetivos Financeiros</h2>
        <div class="form-grid">
            <input type="text" id="nomeObjetivo" placeholder="Nome (ex: Fundo EmergÃªncia)">
            <select id="tipoObjetivo">
                <option value="">Tipo</option>
                <option value="EmergÃªncia">Fundo de EmergÃªncia</option>
                <option value="Aposentadoria">Aposentadoria</option>
                <option value="Viagem">Viagem/Lazer</option>
                <option value="ImÃ³vel">ImÃ³vel</option>
                <option value="Carro">Carro</option>
                <option value="EducaÃ§Ã£o">EducaÃ§Ã£o</option>
                <option value="Outro">Outro</option>
            </select>
            <input type="number" id="metaObjetivo" placeholder="Meta (R$)" step="0.01" min="0">
            <button onclick="adicionarObjetivo()" class="secondary">â• Adicionar</button>
        </div>
        <div id="containerObjetivos" style="margin-top: 20px;"></div>
    </div>

    <!-- GrÃ¡ficos -->
    <div class="secao">
        <h2>ğŸ“ˆ VisualizaÃ§Ãµes</h2>
        <div class="graficos">
            <div class="grafico-container">
                <canvas id="graficoGastos"></canvas>
            </div>
            <div class="grafico-container">
                <canvas id="graficoCategoria"></canvas>
            </div>
            <div class="grafico-container">
                <canvas id="graficoMetas"></canvas>
            </div>
        </div>
    </div>
        <h2>ğŸ·ï¸ Categorias Customizadas</h2>
        <div class="form-grid">
            <input type="text" id="novaCategoria" placeholder="Nome da categoria (ex: Streaming)">
            <input type="text" id="novaEmojiCategoria" placeholder="Emoji (ex: ğŸ“º)" maxlength="2">
            <button class="secondary" onclick="adicionarCategoria()">â• Adicionar Categoria</button>
        </div>
        <div id="categoriasContainer" class="categoria-resumo" style="margin-top: 20px;"></div>
    </div>

    <!-- Backup em Nuvem -->
    <div class="secao">
        <h2>â˜ï¸ Backup e SincronizaÃ§Ã£o</h2>
        <p style="color: #666; margin-bottom: 15px;">ğŸ’¡ Dica: Use para fazer backup ou transferir dados entre dispositivos</p>
        <div class="form-grid">
            <button class="secondary" onclick="fazarBackup()">ğŸ’¾ Fazer Backup (Download)</button>
            <button class="secondary" onclick="document.getElementById('inputBackup').click();">ğŸ“¤ Restaurar Backup</button>
            <input type="file" id="inputBackup" accept=".json" style="display: none;" onchange="restaurarBackup(event)">
            <button class="secondary" onclick="sincronizarNuvem()">â˜ï¸ Sincronizar Nuvem</button>
        </div>
    </div>

    <!-- HistÃ³rico de TransaÃ§Ãµes -->
    <div class="secao">
        <h2>ğŸ“‹ HistÃ³rico de TransaÃ§Ãµes</h2>
        <div style="display: grid; grid-template-columns: 1fr auto; gap: 10px; margin-bottom: 15px;">
            <input type="text" id="filtroDescricao" placeholder="ğŸ” Buscar por descriÃ§Ã£o..." style="grid-column: 1;">
            <div style="display: flex; gap: 10px;">
                <button class="secondary" onclick="exportarCSV()">ğŸ“¥ CSV</button>
                <button class="secondary" onclick="gerarRelatorioPDF()">ğŸ“„ PDF</button>
                <button class="secondary" onclick="limparTudo()" style="background: linear-gradient(135deg, #ff1744 0%, #f50057 100%); color: white;">ğŸ—‘ï¸ Limpar</button>
            </div>
        </div>
        <div id="tabelaContainer" class="lista-transacoes"></div>
    </div>
</div>

<!-- Script principal (carregado APÃ“S seguranca.js) -->
<script src="script.js"></script>

</body>
</html>
